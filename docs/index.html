<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>AWS SDK v3 Client mock - v4.1.0</title><meta name="description" content="Documentation for AWS SDK v3 Client mock"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">AWS SDK v3 Client mock - v4.1.0</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>AWS SDK v3 Client mock - v4.1.0</h2></div><div class="tsd-panel tsd-typography"><div align="center">

<a id="md:aws-sdk-v3-client-mock" class="tsd-anchor"></a><h1><a href="#md:aws-sdk-v3-client-mock">AWS SDK v3 Client mock</a></h1><p>Easy and powerful mocking of AWS SDK v3 Clients.</p>
<p><a href="https://www.npmjs.com/package/aws-sdk-client-mock"><img src="https://img.shields.io/npm/v/aws-sdk-client-mock?color=brightgreen&style=flat-square&label=npm+aws-sdk-client-mock" alt="npm aws-sdk-client-mock"></a>
<a href="https://www.npmjs.com/package/aws-sdk-client-mock-jest"><img src="https://img.shields.io/npm/v/aws-sdk-client-mock-jest?color=brightgreen&style=flat-square&label=npm+aws-sdk-client-mock-jest" alt="npm aws-sdk-client-mock-jest"></a></p>
</div>

<p>Library recommended by the AWS SDK for JavaScript team - see the <a href="https://aws.amazon.com/blogs/developer/mocking-modular-aws-sdk-for-javascript-v3-in-unit-tests/">introductory post on the AWS blog</a>.</p>
<p>Features:</p>
<ul>
<li>üåä&nbsp; <strong>fluent interface</strong> - declaring behavior is short and readable</li>
<li>üîç&nbsp; <strong>matching options</strong> - defining mock behavior by Command type and/or its input payload</li>
<li>üïµÔ∏è&nbsp; <strong>spying</strong> - checking if Commands were actually sent</li>
<li>üÉè&nbsp; <strong>Jest matchers</strong> - easily verifying sent Commands</li>
<li>üñãÔ∏è&nbsp; <strong>fully typed</strong> - same type control for declaring mock&#39;s behavior as when writing regular code</li>
<li>‚úÖ&nbsp; <strong>fully tested</strong> - reliable mocks help instead of impeding</li>
</ul>
<p>In action:</p>
<p><img src="media/aws-client-mock-example.gif" alt="aws-client-mock-example"></p>
<a id="md:table-of-contents" class="tsd-anchor"></a><h3><a href="#md:table-of-contents">Table of Contents</a></h3><ul>
<li><a href="#md:about-aws-sdk-v3">About AWS SDK v3</a></li>
<li><a href="#md:usage">Usage</a><ul>
<li><a href="#md:install">Install</a><ul>
<li><a href="#md:versions-compatibility">Versions compatibility</a></li>
</ul>
</li>
<li><a href="#md:import">Import</a></li>
<li><a href="#md:mock">Mock</a><ul>
<li><a href="#md:dynamodb-documentclient">DynamoDB DocumentClient</a></li>
<li><a href="#md:lib-storage-upload">Lib Storage Upload</a></li>
<li><a href="#md:s3-getobjectcommand">S3 GetObjectCommand</a></li>
<li><a href="#md:paginated-operations">Paginated operations</a></li>
<li><a href="#md:sdk-v2-style-mocks">SDK v2-style mocks</a></li>
</ul>
</li>
<li><a href="#md:inspect">Inspect</a></li>
<li><a href="#md:reset-and-restore">Reset and restore</a></li>
<li><a href="#md:custom-matchers">Custom matchers</a><ul>
<li><a href="#md:jest">Jest</a></li>
<li><a href="#md:vitest">Vitest</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#md:api-reference">API Reference</a></li>
<li><a href="#md:aws-lambda-example">AWS Lambda example</a></li>
<li><a href="#md:caveats">Caveats</a><ul>
<li><a href="#md:mixed-smithytypes-versions">Mixed @smithy/types versions</a></li>
<li><a href="#md:awsclientstub-and-strictfunctiontypes">AwsClientStub and strictFunctionTypes</a></li>
<li><a href="#md:order-of-mock-behaviors">Order of mock behaviors</a></li>
<li><a href="#md:order-of-type-and-instance-mocks">Order of type and instance mocks</a></li>
<li><a href="#md:using-with-mocha">Using with Mocha</a></li>
</ul>
</li>
</ul>
<a id="md:about-aws-sdk-v3" class="tsd-anchor"></a><h2><a href="#md:about-aws-sdk-v3">About AWS SDK v3</a></h2><p>The <a href="https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/welcome.html">AWS SDK for JavaScript version 3</a>,
is the new version of SDK to use in Node.js and browser.
It comes with modular architecture and improved typing,
thanks to being written in TypeScript.</p>
<p>The recommended way of using it is to create a <code>Client</code>
and use it to send <code>Commands</code>.</p>
<p>For example, using SNS Client to publish a message to a topic looks like that:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">sns</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">PublishCommand</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">}));</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`Message published, id: </span><span class="hl-4">${</span><span class="hl-2">result</span><span class="hl-7">.</span><span class="hl-2">MessageId</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>This library provides an easy way to mock sending <code>Commands</code>
and define returned results depending on the <code>Command</code> type and payload.</p>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><a id="md:install" class="tsd-anchor"></a><h3><a href="#md:install">Install</a></h3><pre><code class="language-bash"><span class="hl-6">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-4">-D</span><span class="hl-1"> </span><span class="hl-3">aws-sdk-client-mock</span>
</code><button>Copy</button></pre>
<blockquote>
<p><strong>Warning</strong><br>If you are getting type errors <code>Argument of type &#39;typeof SomeClient&#39; is not assignable to parameter of type...</code>
see instructions <a href="#md:mixed-smithytypes-versions">here</a>.</p>
</blockquote>
<a id="md:versions-compatibility" class="tsd-anchor"></a><h4><a href="#md:versions-compatibility">Versions compatibility</a></h4><table>
<thead>
<tr>
<th><code>@aws-sdk/*</code></th>
<th><code>aws-sdk-client-mock</code></th>
</tr>
</thead>
<tbody><tr>
<td>‚â• 3.363.0</td>
<td>‚â• 3.x</td>
</tr>
<tr>
<td>&lt; 3.363.0</td>
<td>2.x</td>
</tr>
</tbody></table>
<a id="md:import" class="tsd-anchor"></a><h3><a href="#md:import">Import</a></h3><p>CommonJS:</p>
<pre><code class="language-javascript"><span class="hl-4">const</span><span class="hl-1"> {</span><span class="hl-5">mockClient</span><span class="hl-1">} = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>TypeScript / ES6:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<a id="md:mock" class="tsd-anchor"></a><h3><a href="#md:mock">Mock</a></h3><p>Create mock for all instances or for given instance of the AWS SDK Client:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamoDB</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamoDBMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">dynamoDB</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>By default, mocked <code>Client#send()</code> method returns <code>undefined</code>.</p>
<p>Using the obtained mock instance, you can specify the mock behavior
on receiving various commands to send.</p>
<p>See the <a href="https://m-radzikowski.github.io/aws-sdk-client-mock/classes/AwsStub.html">AwsStub API Reference</a>
for all available methods or check out the examples below.</p>
<p>Specify default mock behavior:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">onAnyCommand</span><span class="hl-1">().</span><span class="hl-6">resolves</span><span class="hl-1">({});</span><br/><br/><span class="hl-8">// same as:</span><br/><br/><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">resolves</span><span class="hl-1">({});</span>
</code><button>Copy</button></pre>
<p>Specify mock behavior on receiving given command only:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Specify mock behavior on receiving given command with given payload only:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Not all payload parameters must be defined to match
(you can force strict matching by passing third param <code>strict: true</code>):</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Specify mock behavior on receiving given payload only:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">onAnyCommand</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Multiple behaviors (for different commands and payloads) may be specified
for a single mock:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// default for any command</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// default for PublishCommand</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-4444-5555-6666-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// for PublishCommand with given input</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-7777-8888-9999-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Specify chained behaviors - next behaviors for consecutive calls:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolvesOnce</span><span class="hl-1">({ </span><span class="hl-8">// for the first command call</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-1111-1111-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolvesOnce</span><span class="hl-1">({ </span><span class="hl-8">// for the second command call</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-2222-2222-2222-111122223333&#39;</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({ </span><span class="hl-8">// for further calls</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-3333-3333-3333-111122223333&#39;</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Specify mock throwing an error:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">rejects</span><span class="hl-1">(</span><span class="hl-3">&#39;mocked rejection&#39;</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">throttlingError</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">&#39;mocked rejection&#39;</span><span class="hl-1">);</span><br/><span class="hl-2">throttlingError</span><span class="hl-1">.</span><span class="hl-2">name</span><span class="hl-1"> = </span><span class="hl-3">&#39;ThrottlingException&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">rejects</span><span class="hl-1">(</span><span class="hl-2">throttlingError</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>In <code>rejects()</code>, you can pass a string, an <code>Error</code> instance,
or an object with properties.
In each case, it will be converted to an <code>Error</code> instance.</p>
<p>Specify custom mock function:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">callsFake</span><span class="hl-1">(</span><span class="hl-2">input</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">input</span><span class="hl-1">.</span><span class="hl-2">Message</span><span class="hl-1"> === </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">};</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">&#39;mocked rejection&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Specify custom mock function for a specific command (chained behavior):</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">callsFake</span><span class="hl-1">(</span><span class="hl-2">input</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">input</span><span class="hl-1">.</span><span class="hl-2">Message</span><span class="hl-1"> === </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">};</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">&#39;mocked rejection&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Specify result based on Client configuration, i.e. region:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">callsFake</span><span class="hl-1">(</span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">input</span><span class="hl-1">, </span><span class="hl-2">getClient</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1"> = </span><span class="hl-6">getClient</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">region</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">config</span><span class="hl-1">.</span><span class="hl-6">region</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> {</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-2">region</span><span class="hl-1">.</span><span class="hl-6">substring</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">)};</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Together with <code>resolvesOnce()</code>, you can also use <code>rejectsOnce()</code> and <code>callsFakeOnce()</code>
to specify consecutive behaviors.</p>
<a id="md:dynamodb-documentclient" class="tsd-anchor"></a><h4><a href="#md:dynamodb-documentclient">DynamoDB DocumentClient</a></h4><p>You can mock the <code>DynamoDBDocumentClient</code> just like any other Client:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">DynamoDBClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">DynamoDBDocumentClient</span><span class="hl-1">, </span><span class="hl-2">QueryCommand</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/lib-dynamodb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">ddbMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">DynamoDBDocumentClient</span><span class="hl-1">);</span><br/><span class="hl-2">ddbMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">QueryCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">Items:</span><span class="hl-1"> [{</span><span class="hl-2">pk:</span><span class="hl-1"> </span><span class="hl-3">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-2">sk:</span><span class="hl-1"> </span><span class="hl-3">&#39;b&#39;</span><span class="hl-1">}],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamodb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">ddb</span><span class="hl-1"> = </span><span class="hl-2">DynamoDBDocumentClient</span><span class="hl-1">.</span><span class="hl-6">from</span><span class="hl-1">(</span><span class="hl-2">dynamodb</span><span class="hl-1">);</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">query</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">ddb</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">QueryCommand</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">TableName:</span><span class="hl-1"> </span><span class="hl-3">&#39;mock&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">}));</span>
</code><button>Copy</button></pre>
<a id="md:lib-storage-upload" class="tsd-anchor"></a><h4><a href="#md:lib-storage-upload">Lib Storage Upload</a></h4><p>To mock <code>@aws-sdk/lib-storage</code> <code>Upload</code> you need to mock all commands
used <a href="https://github.com/aws/aws-sdk-js-v3/blob/main/lib/lib-storage/src/Upload.ts">under the hood</a>:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">S3Client</span><span class="hl-1">, </span><span class="hl-2">CreateMultipartUploadCommand</span><span class="hl-1">, </span><span class="hl-2">UploadPartCommand</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-s3&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">Upload</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@aws-sdk/lib-storage&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3Mock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">S3Client</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// for big files upload:</span><br/><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">CreateMultipartUploadCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">UploadId:</span><span class="hl-1"> </span><span class="hl-3">&#39;1&#39;</span><span class="hl-1">});</span><br/><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">UploadPartCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">ETag:</span><span class="hl-1"> </span><span class="hl-3">&#39;1&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-8">// for small files upload:</span><br/><span class="hl-2">s3ClientMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PutObjectCommand</span><span class="hl-1">).</span><span class="hl-6">callsFake</span><span class="hl-1">(</span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">input</span><span class="hl-1">, </span><span class="hl-2">getClient</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">getClient</span><span class="hl-1">().</span><span class="hl-2">config</span><span class="hl-1">.</span><span class="hl-6">endpoint</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><span class="hl-1"> ({</span><span class="hl-2">hostname:</span><span class="hl-1"> </span><span class="hl-3">&quot;&quot;</span><span class="hl-1">}) </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-10">any</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> {};</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3Upload</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Upload</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">client:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">S3Client</span><span class="hl-1">({}),</span><br/><span class="hl-1">    </span><span class="hl-2">params:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">Bucket:</span><span class="hl-1"> </span><span class="hl-3">&#39;mock&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Key:</span><span class="hl-1"> </span><span class="hl-3">&#39;test&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">Body:</span><span class="hl-1"> </span><span class="hl-3">&#39;x&#39;</span><span class="hl-1">.</span><span class="hl-6">repeat</span><span class="hl-1">(</span><span class="hl-9">6</span><span class="hl-1"> * </span><span class="hl-9">1024</span><span class="hl-1"> * </span><span class="hl-9">1024</span><span class="hl-1">), </span><span class="hl-8">// 6 MB</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">s3Upload</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&#39;httpUploadProgress&#39;</span><span class="hl-1">, (</span><span class="hl-2">progress</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-2">progress</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">s3Upload</span><span class="hl-1">.</span><span class="hl-6">done</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<p>This way, the  <code>Upload#done()</code> will complete successfuly.</p>
<p>To cause a failure, you need to specify the <code>rejects()</code> behavior
for one of the AWS SDK Commands used by the <code>@aws-sdk/lib-storage</code>.</p>
<p>For uploading a small file (under the defined multipart upload single part size),
<code>lib-storage</code> sends a <code>PutObjectCommand</code>. To make it fail:</p>
<pre><code class="language-ts"><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PutObjectCommand</span><span class="hl-1">).</span><span class="hl-6">rejects</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<p>For bigger files, it makes a series of calls including <code>CreateMultipartUploadCommand</code>,
<code>UploadPartCommand</code>, and <code>CompleteMultipartUploadCommand</code>. Making any of them fail will fail the upload:</p>
<pre><code class="language-ts"><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">UploadPartCommand</span><span class="hl-1">).</span><span class="hl-6">rejects</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:s3-getobjectcommand" class="tsd-anchor"></a><h4><a href="#md:s3-getobjectcommand">S3 GetObjectCommand</a></h4><p>AWS SDK wraps the stream in the S3 <code>GetObjectCommand</code> result to provide utility methods to parse it.
To mock it, you need to install the <a href="https://www.npmjs.com/package/@smithy/util-stream"><code>@smithy/util-stream</code></a> package
and call the wrapping function <code>sdkStreamMixin()</code> on the stream you provide as the command output:</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">GetObjectCommand</span><span class="hl-1">, </span><span class="hl-2">S3Client</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-s3&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">sdkStreamMixin</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@smithy/util-stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">Readable</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">createReadStream</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3Mock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">S3Client</span><span class="hl-1">);</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;mocks get object&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">// create Stream from string</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">stream</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Readable</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">stream</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(</span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">stream</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(</span><span class="hl-4">null</span><span class="hl-1">); </span><span class="hl-8">// end of stream</span><br/><br/><span class="hl-1">    </span><span class="hl-8">// alternatively: create Stream from file</span><br/><span class="hl-1">    </span><span class="hl-8">// const stream = createReadStream(&#39;./test/data.txt&#39;);</span><br/><br/><span class="hl-1">    </span><span class="hl-8">// wrap the Stream with SDK mixin</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sdkStream</span><span class="hl-1"> = </span><span class="hl-6">sdkStreamMixin</span><span class="hl-1">(</span><span class="hl-2">stream</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-2">s3Mock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">GetObjectCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">Body:</span><span class="hl-1"> </span><span class="hl-2">sdkStream</span><span class="hl-1">});</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">s3</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">S3Client</span><span class="hl-1">({});</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">getObjectResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">s3</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">GetObjectCommand</span><span class="hl-1">({</span><span class="hl-2">Bucket:</span><span class="hl-1"> </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">Key:</span><span class="hl-1"> </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">}));</span><br/><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">str</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">getObjectResult</span><span class="hl-1">.</span><span class="hl-2">Body</span><span class="hl-1">?.</span><span class="hl-6">transformToString</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">str</span><span class="hl-1">).</span><span class="hl-6">toBe</span><span class="hl-1">(</span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:paginated-operations" class="tsd-anchor"></a><h4><a href="#md:paginated-operations">Paginated operations</a></h4><p>To mock a <a href="https://aws.amazon.com/blogs/developer/pagination-using-async-iterators-in-modular-aws-sdk-for-javascript/">paginated operation</a>
results, simply mock the corresponding Command:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">DynamoDBClient</span><span class="hl-1">, </span><span class="hl-2">paginateQuery</span><span class="hl-1">, </span><span class="hl-2">QueryCommand</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-dynamodb&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">marshall</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/util-dynamodb&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamodbMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">DynamoDBClient</span><span class="hl-1">);</span><br/><span class="hl-2">dynamodbMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">QueryCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">Items:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-6">marshall</span><span class="hl-1">({</span><span class="hl-2">pk:</span><span class="hl-1"> </span><span class="hl-3">&#39;a&#39;</span><span class="hl-1">, </span><span class="hl-2">sk:</span><span class="hl-1"> </span><span class="hl-3">&#39;b&#39;</span><span class="hl-1">}),</span><br/><span class="hl-1">        </span><span class="hl-6">marshall</span><span class="hl-1">({</span><span class="hl-2">pk:</span><span class="hl-1"> </span><span class="hl-3">&#39;c&#39;</span><span class="hl-1">, </span><span class="hl-2">sk:</span><span class="hl-1"> </span><span class="hl-3">&#39;d&#39;</span><span class="hl-1">}),</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dynamodb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DynamoDBClient</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">paginator</span><span class="hl-1"> = </span><span class="hl-6">paginateQuery</span><span class="hl-1">({</span><span class="hl-2">client:</span><span class="hl-1"> </span><span class="hl-2">dynamodb</span><span class="hl-1">}, {</span><span class="hl-2">TableName:</span><span class="hl-1"> </span><span class="hl-3">&#39;mock&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">items</span><span class="hl-1"> = [];</span><br/><span class="hl-0">for</span><span class="hl-1"> </span><span class="hl-0">await</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">page</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">paginator</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">items</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">(...</span><span class="hl-2">page</span><span class="hl-1">.</span><span class="hl-2">Items</span><span class="hl-1"> || []);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:sdk-v2-style-mocks" class="tsd-anchor"></a><h4><a href="#md:sdk-v2-style-mocks">SDK v2-style mocks</a></h4><p>The AWS SDK v3 gives an option to use it similarly to v2 SDK,
with command method call instead of <code>send()</code>:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">SNS</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNS</span><span class="hl-1">({});</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">sns</span><span class="hl-1">.</span><span class="hl-6">publish</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-3">&#39;arn:aws:sns:us-east-1:111111111111:MyTopic&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Although this approach is not recommended by AWS,
those calls can be mocked in the standard way:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">);</span><br/><span class="hl-2">snsMock</span><br/><span class="hl-1">    .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span><br/><span class="hl-1">    .</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span>
</code><button>Copy</button></pre>
<p>Notice that in mocks you still need to use <code>SNSClient</code>, not <code>SNS</code>,
as well as <code>Command</code> classes.</p>
<a id="md:inspect" class="tsd-anchor"></a><h3><a href="#md:inspect">Inspect</a></h3><p>Inspect received calls:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">calls</span><span class="hl-1">(); </span><span class="hl-8">// all received calls</span><br/><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">call</span><span class="hl-1">(</span><span class="hl-9">0</span><span class="hl-1">); </span><span class="hl-8">// first received call</span>
</code><button>Copy</button></pre>
<p>Get calls of a specified command:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">commandCalls</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>
<p>Get calls of a specified command with given payload
(you can force strict matching by passing third param <code>strict: true</code>):</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">commandCalls</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;My message&#39;</span><span class="hl-1">})</span>
</code><button>Copy</button></pre>
<p>Under the hood, the library uses <a href="https://sinonjs.org/">Sinon.js</a> <code>stub</code>.
You can get the stub instance to configure and use it directly:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsSendStub</span><span class="hl-1"> = </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<a id="md:reset-and-restore" class="tsd-anchor"></a><h3><a href="#md:reset-and-restore">Reset and restore</a></h3><p>The Client mock exposes three <a href="https://sinonjs.org/">Sinon.js</a> <code>stub</code> methods:
<code>reset()</code>, <code>resetHistory()</code>, and <code>restore()</code>.</p>
<p>The <code>reset()</code> method resets the mock state and behavior.
The Client will continue to be mocked, only now with a clean mock instance,
without any behavior (set with methods like <code>on(...).resolves(...)</code>) and calls history.</p>
<p><strong>You should call <code>clientMock.reset()</code> before or after every test
(using <code>beforeEach()</code> / <code>beforeAll()</code> from your test framework)
to keep tests independent from each other.</strong></p>
<p>The <code>resetHistory()</code> only clear mocked client calls history
that you access with <code>mockedClient.call(...)</code> and <code>mockedClient.calls()</code>.
The behavior is preserved.</p>
<p>The <code>restore()</code> removes the mock altogether,
restoring the normal behavior of <code>client.send()</code>.</p>
<p>You can also pass custom <a href="https://sinonjs.org/releases/latest/sandbox/">Sinon Sandbox</a>
with <code>mockClient(client, { sandbox: mySandbox })</code>
to manage all mocks lifecycle at once.</p>
<a id="md:custom-matchers" class="tsd-anchor"></a><h3><a href="#md:custom-matchers">Custom matchers</a></h3><a id="md:jest" class="tsd-anchor"></a><h4><a href="#md:jest">Jest</a></h4><p>Custom <a href="https://jestjs.io/">Jest</a> matchers simplify verification
that the mocked Client was called with given Commands.</p>
<p>Matchers are published as a separate package. Install it:</p>
<pre><code class="language-bash"><span class="hl-6">npm</span><span class="hl-1"> </span><span class="hl-3">install</span><span class="hl-1"> </span><span class="hl-4">-D</span><span class="hl-1"> </span><span class="hl-3">aws-sdk-client-mock-jest</span>
</code><button>Copy</button></pre>
<p>Usage (notice the <code>import</code>):</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock-jest&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// a PublishCommand was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommand</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// at least one command was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedAnyCommand</span><span class="hl-1">();</span><br/><br/><span class="hl-8">// two PublishCommands were sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandTimes</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><br/><span class="hl-8">// a PublishCommand with Message &quot;hello world&quot; was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandWith</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">}</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// a PublishCommand with Message containing &quot;hello&quot; was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandWith</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-2">expect</span><span class="hl-1">.</span><span class="hl-6">stringContaining</span><span class="hl-1">(</span><span class="hl-3">&#39;hello&#39;</span><span class="hl-1">)}</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// the second command sent to SNS was a PublishCommand with Message &quot;hello world&quot;</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedNthCommandWith</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-9">2</span><span class="hl-1">, </span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">}</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// the second PublishCommand sent to SNS had Message &quot;hello world&quot;</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedNthSpecificCommandWith</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-9">2</span><span class="hl-1">, </span><span class="hl-2">PublishCommand</span><span class="hl-1">, {</span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-3">&#39;hello world&#39;</span><span class="hl-1">}</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Shorter aliases exist, like <code>toReceiveCommandTimes()</code>.</p>
<a id="md:vitest" class="tsd-anchor"></a><h4><a href="#md:vitest">Vitest</a></h4><p>Use those matchers with <a href="https://vitest.dev/">Vitest</a>:</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock-jest/vitest&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">expect</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;vitest&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// a PublishCommand was sent to SNS</span><br/><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommand</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>To use the matchers outside of Jest, you can pull in the <a href="https://www.npmjs.com/package/expect">expect</a> library separately
and add it to the global scope directly, e.g.:</p>
<pre><code class="language-ts"><span class="hl-4">const</span><span class="hl-1"> {</span><span class="hl-5">expect</span><span class="hl-1">} = </span><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&quot;expect&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">(</span><span class="hl-2">globalThis</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-10">any</span><span class="hl-1">).</span><span class="hl-2">expect</span><span class="hl-1"> = </span><span class="hl-2">expect</span><span class="hl-1">;</span><br/><span class="hl-6">require</span><span class="hl-1">(</span><span class="hl-3">&quot;aws-sdk-client-mock-jest&quot;</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:api-reference" class="tsd-anchor"></a><h2><a href="#md:api-reference">API Reference</a></h2><p>See the <a href="https://m-radzikowski.github.io/aws-sdk-client-mock/">full API Reference</a>.</p>
<a id="md:aws-lambda-example" class="tsd-anchor"></a><h2><a href="#md:aws-lambda-example">AWS Lambda example</a></h2><p>Example below uses Jest as a test framework, but mocks will work with any testing library.</p>
<p>Let&#39;s take a simple Lambda function that takes a list of messages,
sends them to SNS topic and returns message IDs:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsTopicArn</span><span class="hl-1"> = </span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">env</span><span class="hl-1">.</span><span class="hl-5">SNS_TOPIC_ARN</span><span class="hl-1"> || </span><span class="hl-3">&#39;&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">handler</span><span class="hl-1"> = </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">event</span><span class="hl-1">: </span><span class="hl-10">Event</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">[]&gt; </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">promises</span><span class="hl-1"> = </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">messages</span><span class="hl-1">.</span><span class="hl-6">map</span><span class="hl-1">(</span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">msg</span><span class="hl-1">, </span><span class="hl-2">idx</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">publish</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">sns</span><span class="hl-1">.</span><span class="hl-6">send</span><span class="hl-1">(</span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">PublishCommand</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-2">TopicArn:</span><span class="hl-1"> </span><span class="hl-2">snsTopicArn</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">Message:</span><span class="hl-1"> </span><span class="hl-2">msg</span><span class="hl-1">,</span><br/><span class="hl-1">    }));</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">publish</span><span class="hl-1">.</span><span class="hl-2">MessageId</span><span class="hl-1">!;</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">.</span><span class="hl-6">all</span><span class="hl-1">(</span><span class="hl-2">promises</span><span class="hl-1">);</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-10">Event</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">messages</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Then the tests could look like this:</p>
<pre><code class="language-typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">SNSClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@aws-sdk/client-sns&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">handler</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;../src&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">snsMock</span><span class="hl-1"> = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">);</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * To be sure that unit tests are independent from each other,</span><br/><span class="hl-8"> * reset mock behavior between the tests.</span><br/><span class="hl-8"> */</span><br/><span class="hl-6">beforeEach</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">reset</span><span class="hl-1">();</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;message IDs are returned&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">handler</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><span class="hl-3">&#39;one&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;two&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;three&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">).</span><span class="hl-6">toHaveLength</span><span class="hl-1">(</span><span class="hl-9">3</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">result</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">]).</span><span class="hl-6">toBe</span><span class="hl-1">(</span><span class="hl-3">&#39;12345678-1111-2222-3333-111122223333&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-3">&#39;SNS Client is called with PublishCommand&#39;</span><span class="hl-1">, </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">snsMock</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;111-222-333&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">handler</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">messages:</span><span class="hl-1"> [</span><span class="hl-3">&#39;qq&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;xx&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-2">snsMock</span><span class="hl-1">).</span><span class="hl-6">toHaveReceivedCommandTimes</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>For more examples, see the <a href="packages/aws-sdk-client-mock/test/mockClient.test.ts">unit tests</a>.</p>
<a id="md:caveats" class="tsd-anchor"></a><h2><a href="#md:caveats">Caveats</a></h2><a id="md:mixed-smithytypes-versions" class="tsd-anchor"></a><h3><a href="#md:mixed-smithytypes-versions">Mixed @smithy/types versions</a></h3><blockquote>
<p><strong>Note</strong><br>Those instructions refer to <code>@smithy/types</code> used by AWS SDK v3.363.0 and above.
For version below 3.363.0, perform the same steps for the <code>@aws-sdk/types</code> package.</p>
</blockquote>
<p>If you have multiple versions of <code>@smithy/types</code> installed in your project,
you can get type errors similar to this:</p>
<pre><code><span class="hl-11">TS2345</span><span class="hl-1">: </span><span class="hl-2">Argument</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;typeof DynamoDBDocumentClient&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">parameter</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;InstanceOrClassType&lt;Client&lt;ServiceInputTypes, MetadataBearer, any&gt;&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">  </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;typeof DynamoDBDocumentClient&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;ClassType&lt;Client&lt;ServiceInputTypes, MetadataBearer, any&gt;&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">    </span><span class="hl-2">The</span><span class="hl-1"> </span><span class="hl-2">types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-3">&#39;prototype.middlewareStack.concat&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1"> </span><span class="hl-2">between</span><span class="hl-1"> </span><span class="hl-2">these</span><span class="hl-1"> </span><span class="hl-2">types</span><span class="hl-1">.</span><br/><span class="hl-1">      </span><span class="hl-2">Type</span><span class="hl-1"> </span><span class="hl-3">&#39;&lt;InputType extends ServiceInputTypes, OutputType extends ServiceOutputTypes&gt;(from: MiddlewareStack&lt;InputType, OutputType&gt;) =&gt; MiddlewareStack&lt;...&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">not</span><span class="hl-1"> </span><span class="hl-2">assignable</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;&lt;InputType extends ServiceInputTypes, OutputType extends MetadataBearer&gt;(from: MiddlewareStack&lt;InputType, OutputType&gt;) =&gt; MiddlewareStack&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1">.</span><br/><span class="hl-1">        </span><span class="hl-2">Types</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">parameters</span><span class="hl-1"> </span><span class="hl-3">&#39;from&#39;</span><span class="hl-1"> </span><span class="hl-2">and</span><span class="hl-1"> </span><span class="hl-3">&#39;from&#39;</span><span class="hl-1"> </span><span class="hl-2">are</span><span class="hl-1"> </span><span class="hl-2">incompatible</span><span class="hl-1">.</span><br/><span class="hl-1">          </span><span class="hl-2">Property</span><span class="hl-1"> </span><span class="hl-3">&#39;identify&#39;</span><span class="hl-1"> </span><span class="hl-2">is</span><span class="hl-1"> </span><span class="hl-2">missing</span><span class="hl-1"> </span><span class="hl-4">in</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareStack&lt;InputType, OutputType&gt;&#39;</span><span class="hl-1"> </span><span class="hl-2">but</span><span class="hl-1"> </span><span class="hl-2">required</span><span class="hl-1"> </span><span class="hl-4">in</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">&#39;MiddlewareStack&lt;InputType, ServiceOutputTypes&gt;&#39;</span><span class="hl-1">.</span>
</code><button>Copy</button></pre>
<p>Run <code>npm ls @smithy/types</code> / <code>pnpm why @smithy/types</code> / <code>yarn why @smithy/types</code>
and check if you have more than one version of the package installed.</p>
<p>To solve this, go through the steps until one works:</p>
<ul>
<li>make sure all your <code>@aws-sdk/*</code> packages point to the same version,</li>
<li>remove all <code>@aws-sdk/*</code> packages from <code>package.json</code>, run <code>npm install</code> / <code>pnpm install</code> / <code>yarn install</code>,
restore <code>@aws-sdk/*</code> packages in <code>package.json</code>, and run install again,</li>
<li>add <code>@smithy/types</code> to your dev dependencies in the latest version,</li>
<li>force using single <code>@smithy/types</code> version with <a href="https://docs.npmjs.com/cli/v9/configuring-npm/package-json#overrides">npm overrides</a>,
<a href="https://pnpm.io/package_json#pnpmoverrides">pnpm overrides</a>, or <a href="https://yarnpkg.com/configuration/manifest#resolutions">yarn resolutions</a>,</li>
<li>if nothing else helped, open an issue including the output of <code>npm ls @smithy/types</code> / <code>pnpm why @smithy/types</code> / <code>yarn why @smithy/types</code>.</li>
</ul>
<a id="md:awsclientstub-and-strictfunctiontypes" class="tsd-anchor"></a><h3><a href="#md:awsclientstub-and-strictfunctiontypes">AwsClientStub and strictFunctionTypes</a></h3><p>If you need to explicitly type the mock variable,
you can use <code>AwsClientStub</code> type:</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">AwsClientStub</span><span class="hl-1">, </span><span class="hl-2">mockClient</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;aws-sdk-client-mock&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> {</span><span class="hl-2">S3Client</span><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@aws-sdk/client-s3&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">mock</span><span class="hl-1">: </span><span class="hl-10">AwsClientStub</span><span class="hl-1">&lt;</span><span class="hl-10">S3Client</span><span class="hl-1">&gt; = </span><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">S3Client</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>The <code>AwsClientStub</code> type works only with <code>tsconfig</code> option
<code>strictFunctionTypes=true</code> or (<code>strict=true</code>) in <code>tsconfig.json</code> file.</p>
<p>See details in <a href="https://github.com/m-radzikowski/aws-sdk-client-mock/issues/167">#167</a>.</p>
<a id="md:order-of-mock-behaviors" class="tsd-anchor"></a><h3><a href="#md:order-of-mock-behaviors">Order of mock behaviors</a></h3><p>Wider Command matchers must be declared first,
otherwise, they will take precedence over previous ones.</p>
<p>In this case, all <code>PublishCommand</code> sends will return message ID <code>222</code>:</p>
<pre><code class="language-typescript"><span class="hl-2">snsMock</span><br/><span class="hl-1">  .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">, </span><span class="hl-2">myInput</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;111&#39;</span><span class="hl-1">})</span><br/><span class="hl-1">  .</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-2">PublishCommand</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;222&#39;</span><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>If the order of the declarations is switched, sends with input matching <code>myInput</code>
will return ID <code>111</code> and all others <code>222</code>.</p>
<p>It works similarly with <code>onAnyCommand()</code>.</p>
<a id="md:order-of-type-and-instance-mocks" class="tsd-anchor"></a><h3><a href="#md:order-of-type-and-instance-mocks">Order of type and instance mocks</a></h3><p>When you create both a Client type mock
and a specific Client instance mock(s),
you need to declare type mock last.
Otherwise, the other instances will not be mocked.</p>
<p>Right now if you create a mock for the Client type,
and then mock a specific instance of this Client,
with the order of mocking as here:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns1</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// not mocked</span><br/><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;123&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns2</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked</span><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">sns2</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;456&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns3</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// not mocked</span>
</code><button>Copy</button></pre>
<p>Declaring mocks in this order will fix it:</p>
<pre><code class="language-typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns1</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked - default</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns2</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked</span><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">sns2</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;456&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-6">mockClient</span><span class="hl-1">(</span><span class="hl-2">SNSClient</span><span class="hl-1">).</span><span class="hl-6">resolves</span><span class="hl-1">({</span><span class="hl-2">MessageId:</span><span class="hl-1"> </span><span class="hl-3">&#39;123&#39;</span><span class="hl-1">});</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">sns3</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">SNSClient</span><span class="hl-1">({}); </span><span class="hl-8">// mocked - default</span>
</code><button>Copy</button></pre>
<p>PRs to fix this are welcome.</p>
<a id="md:using-with-mocha" class="tsd-anchor"></a><h3><a href="#md:using-with-mocha">Using with Mocha</a></h3><p>When testing with Mocha, call <code>mockClient()</code>
in the <code>beforeEach()</code> method, not in the global scope,
to prevent overriding the mock between test files.
See <a href="https://github.com/m-radzikowski/aws-sdk-client-mock/issues/64">this</a>
for more details.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:aws-sdk-v3-client-mock"><span>AWS SDK v3 <wbr/>Client mock</span></a><ul><li><ul><li><a href="#md:table-of-contents"><span>Table of <wbr/>Contents</span></a></li></ul></li><li><a href="#md:about-aws-sdk-v3"><span>About AWS SDK v3</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:install"><span>Install</span></a></li><li><ul><li><a href="#md:versions-compatibility"><span>Versions compatibility</span></a></li></ul></li><li><a href="#md:import"><span>Import</span></a></li><li><a href="#md:mock"><span>Mock</span></a></li><li><ul><li><a href="#md:dynamodb-documentclient"><span>DynamoDB <wbr/>Document<wbr/>Client</span></a></li><li><a href="#md:lib-storage-upload"><span>Lib <wbr/>Storage <wbr/>Upload</span></a></li><li><a href="#md:s3-getobjectcommand"><span>S3 <wbr/>Get<wbr/>Object<wbr/>Command</span></a></li><li><a href="#md:paginated-operations"><span>Paginated operations</span></a></li><li><a href="#md:sdk-v2-style-mocks"><span>SDK v2-<wbr/>style mocks</span></a></li></ul></li><li><a href="#md:inspect"><span>Inspect</span></a></li><li><a href="#md:reset-and-restore"><span>Reset and restore</span></a></li><li><a href="#md:custom-matchers"><span>Custom matchers</span></a></li><li><ul><li><a href="#md:jest"><span>Jest</span></a></li><li><a href="#md:vitest"><span>Vitest</span></a></li></ul></li></ul></li><li><a href="#md:api-reference"><span>API <wbr/>Reference</span></a></li><li><a href="#md:aws-lambda-example"><span>AWS <wbr/>Lambda example</span></a></li><li><a href="#md:caveats"><span>Caveats</span></a></li><li><ul><li><a href="#md:mixed-smithytypes-versions"><span>Mixed @smithy/types versions</span></a></li><li><a href="#md:awsclientstub-and-strictfunctiontypes"><span>Aws<wbr/>Client<wbr/>Stub and strict<wbr/>Function<wbr/>Types</span></a></li><li><a href="#md:order-of-mock-behaviors"><span>Order of mock behaviors</span></a></li><li><a href="#md:order-of-type-and-instance-mocks"><span>Order of type and instance mocks</span></a></li><li><a href="#md:using-with-mocha"><span>Using with <wbr/>Mocha</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>AWS SDK v3 Client mock - v4.1.0</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>